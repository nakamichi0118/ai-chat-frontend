<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アイユーくんAIチャット</title>
    <link rel="icon" type="image/png" href="/aiyu-icons/こんにちは.png">
    <link rel="stylesheet" href="styles-enhanced.css?v=20250812_1130">
    <link rel="stylesheet" href="aiyu-styles-v2.css?v=20250812_1145">
    <script src="config.js?v=20250814_1315_fix"></script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <button class="new-chat-btn" id="newChatButton" onclick="newChat()">+ 新しいチャット</button>
                <button class="export-btn" onclick="exportChat()" style="margin-top: 8px; width: 100%; padding: 8px; background: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                    📥 チャットをエクスポート
                </button>
            </div>
            <div class="chat-history" id="chatHistory">
            </div>
            <div class="sidebar-footer">
                <div class="model-selector">
                    <label for="modelSelect">モデル選択:</label>
                    <select id="modelSelect">
                        <option value="gemini-2.5-flash">Gemini 2.5 Flash (最新・高速)</option>
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro (最新・高性能)</option>
                        <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                        <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                        <option value="gpt-4">GPT-4</option>
                        <option value="gpt-4-turbo">GPT-4 Turbo</option>
                        <option value="gpt-4o">GPT-4o</option>
                        <option value="gpt-4o-mini">GPT-4o Mini</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="main-chat">
            <div class="chat-header">
                <div class="header-content">
                    <img src="/aiyu-icons/こんにちは.png" alt="アイユー" class="aiyu-logo" style="width: 24px; height: 24px;">
                    <h1>アイユーくんAIチャット</h1>
                </div>
                <img src="/iucglog.png" alt="会社ロゴ" class="company-logo" style="height: 32px;">
            </div>
            
            <div class="messages" id="messages">
                <div class="welcome-message">
                    <h2 style="color: #1e3a8a; font-weight: 700;"><img src="/aiyu-icons/こんにちは.png" alt="アイユーくん" style="width: 32px; height: 32px; vertical-align: middle; margin-right: 8px;">アイユーくんAIチャットへようこそ！</h2>
                    <p style="color: #3b5998;">なんでもきいてくださいワン！お手伝いしますワン🐾</p>
                    <p class="info" style="color: #64748b; font-size: 12px;">※ 安心して使ってくださいワン</p>
                </div>
            </div>
            
            <div class="input-controls">
                <div class="feature-toggles">
                    <button class="toggle-btn" id="knowledgeToggle" onclick="toggleKnowledge()" title="ナレッジベース参照">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="toggle-label">ナレッジ</span>
                    </button>
                    <button class="toggle-btn" id="voiceToggle" onclick="toggleVoice()" title="音声入力">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 1C10.34 1 9 2.34 9 4V12C9 13.66 10.34 15 12 15C13.66 15 15 13.66 15 12V4C15 2.34 13.66 1 12 1Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M19 10V12C19 15.86 15.86 19 12 19C8.14 19 5 15.86 5 12V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 19V23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8 23H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="toggle-label">音声</span>
                    </button>
                    <button class="toggle-btn" id="speakToggle" onclick="toggleSpeak()" title="読み上げ">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M11 5L6 9H2V15H6L11 19V5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M19.07 4.93C20.94 6.8 22 9.3 22 12C22 14.7 20.94 17.2 19.07 19.07M15.54 8.46C16.48 9.4 17 10.65 17 12C17 13.35 16.48 14.6 15.54 15.54" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="toggle-label">読み上げ</span>
                    </button>
                    <button class="toggle-btn" id="personalityToggle" onclick="togglePersonality()" title="アイユーくん人格モード">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2C13.5 2 15 3 15 5C15 7 13.5 8 12 8C10.5 8 9 7 9 5C9 3 10.5 2 12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 22C16 22 18 18 18 14C18 12 17 10 15 9C14 8.5 13 8.2 12 8.2C11 8.2 10 8.5 9 9C7 10 6 12 6 14C6 18 8 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="9.5" cy="12" r="1" fill="currentColor"/>
                            <circle cx="14.5" cy="12" r="1" fill="currentColor"/>
                            <path d="M9 15S10 17 12 17S15 15 15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span class="toggle-label">アイユーくんモード</span>
                    </button>
                    <button class="toggle-btn" id="researchToggle" onclick="toggleResearchMode()" title="リサーチモード（ウェブ検索強化）">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                            <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="11" cy="11" r="3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span class="toggle-label">リサーチ</span>
                    </button>
                    <button class="toggle-btn" id="promptsToggle" onclick="togglePromptsPanel()" title="税理士業務プロンプト集">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M9 5H2V19H22V5H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M15 3H9V5H15V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8 12H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8 15H14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="toggle-label">プロンプト</span>
                    </button>
                </div>
                <div class="knowledge-status" id="knowledgeStatus" style="display: none;">
                    <span class="status-icon">📚</span>
                    <span class="status-text">ナレッジベース接続中...</span>
                </div>
            </div>
            <div class="input-area">
                <div id="filePreview" class="file-preview" style="display: none;"></div>
                <button class="file-attach-btn" id="fileAttachBtn" title="ファイルを添付">
                    <input type="file" id="fileInput" multiple accept="image/*,.pdf,.txt,.md,.js,.py,.java,.cpp,.c,.h,.json,.xml,.csv">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <textarea 
                    id="messageInput" 
                    placeholder="メッセージを入力... (Shift+Enterで改行)"
                    rows="1"
                ></textarea>
                <button id="sendButton">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <button id="voiceButton" class="voice-btn" onclick="startVoiceInput()" style="display: none;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" fill="red" class="recording-indicator" style="display: none;"/>
                        <path d="M12 1C10.34 1 9 2.34 9 4V12C9 13.66 10.34 15 12 15C13.66 15 15 13.66 15 12V4C15 2.34 13.66 1 12 1Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
        <!-- プロンプト集パネル -->
        <div id="promptsPanel" class="prompts-panel" style="display: none;">
            <div class="prompts-header">
                <h3>税理士業務プロンプト集</h3>
                <button class="close-btn" onclick="togglePromptsPanel()">×</button>
            </div>
            <div class="prompts-content">
                <div class="prompts-category">
                    <h4>📊 顧問業務</h4>
                    <div class="prompt-item" onclick="insertPrompt('記帳代行の業務フローを効率化するための具体的な改善提案を5つ教えてください。')">
                        記帳代行の効率化
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('月次決算のチェックリストを作成してください。確認すべき勘定科目と具体的な確認ポイントを含めてください。')">
                        月次決算チェックリスト
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('法人税申告書の作成手順を初心者向けに分かりやすく説明してください。必要な書類と注意点も含めてください。')">
                        法人税申告の手順
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('消費税の課税・非課税・不課税・免税の判定基準を具体例を交えて説明してください。')">
                        消費税区分の判定
                    </div>
                </div>
                <div class="prompts-category">
                    <h4>🏠 相続業務</h4>
                    <div class="prompt-item" onclick="insertPrompt('相続税申告に必要な書類一覧を、取得先と取得期限を含めて作成してください。')">
                        相続税申告の必要書類
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('小規模宅地等の特例の適用要件と計算方法を具体例で説明してください。')">
                        小規模宅地等の特例
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('遺産分割協議書の作成ポイントと必須記載事項を教えてください。')">
                        遺産分割協議書の作成
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('相続税の概算計算方法と、節税対策として検討すべき5つのポイントを教えてください。')">
                        相続税の節税対策
                    </div>
                </div>
                <div class="prompts-category">
                    <h4>💼 バックオフィス業務</h4>
                    <div class="prompt-item" onclick="insertPrompt('給与計算業務のマニュアルを作成してください。社会保険料と税金の計算方法を含めてください。')">
                        給与計算マニュアル
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('年末調整の業務フローと必要書類、締切スケジュールを一覧にしてください。')">
                        年末調整の業務フロー
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('経費精算のルールと承認フローのテンプレートを作成してください。')">
                        経費精算ルール
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('新入社員向けの税務基礎知識研修カリキュラムを作成してください。')">
                        新人研修カリキュラム
                    </div>
                </div>
                <div class="prompts-category">
                    <h4>📈 経営支援</h4>
                    <div class="prompt-item" onclick="insertPrompt('財務分析レポートのテンプレートを作成してください。主要な経営指標と改善提案を含めてください。')">
                        財務分析レポート
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('資金繰り表の作成方法と、資金ショートを防ぐための5つのポイントを教えてください。')">
                        資金繰り管理
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('事業計画書の作成支援として、必要な項目と記載すべき内容を詳しく説明してください。')">
                        事業計画書の作成
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('補助金・助成金の申請サポートのため、主要な制度と申請要件をまとめてください。')">
                        補助金・助成金情報
                    </div>
                </div>
                <div class="prompts-category">
                    <h4>🔍 調査・確認</h4>
                    <div class="prompt-item" onclick="insertPrompt('税務調査の対応マニュアルを作成してください。準備すべき書類と想定質問への回答例を含めてください。')">
                        税務調査対応
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('最新の税制改正のポイントと、クライアントへの影響を分かりやすくまとめてください。')">
                        税制改正の影響
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('インボイス制度の実務対応チェックリストを作成してください。')">
                        インボイス制度対応
                    </div>
                    <div class="prompt-item" onclick="insertPrompt('電子帳簿保存法の要件と実務対応方法を説明してください。')">
                        電子帳簿保存法
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // PDF.jsのワーカー設定
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <script src="app-enhanced.js?v=20250814_1315_fix"></script>
</body>
</html><!-- Updated: Thu Aug 21 08:23:46 JST 2025 -->
